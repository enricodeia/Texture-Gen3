/**
 * Texture Gen v2 - Main JavaScript
 * 
 * This script handles all the functionality for the Texture Gen v2 application,
 * including texture map generation, 3D preview, UI interactions, and export functionality.
 * 
 * @author Enrico Deiana
 * @version 2.0
 * @license MIT
 */ document.addEventListener("DOMContentLoaded",function(){let e,t,a,n,i,r,o,l,s,d,c,g,m=!1,u=!0,h={x:5e-4,y:.004},p=!1,$=!1,f=null,v={x:0,y:0},x=!0,w={baseStrength:1,normalStrength:1,roughnessStrength:.5,displacementStrength:.2,aoStrength:.5,metalness:0,lightX:5,lightY:5,lightZ:5},E=document.getElementById("upload-area"),y=document.querySelector(".upload-content"),_=document.getElementById("texture-upload"),L=document.getElementById("preview-overlay"),b=document.getElementById("uploaded-image"),I=document.getElementById("delete-image"),B=document.getElementById("model-container"),C=document.getElementById("resolution-stat"),S=document.getElementById("filesize-stat"),T=document.getElementById("format-stat"),k=document.getElementById("base-map-size"),P=document.getElementById("normal-map-size"),R=document.getElementById("roughness-map-size"),D=document.getElementById("displacement-map-size"),U=document.getElementById("ao-map-size"),M=document.querySelectorAll(".nav-tab"),j=document.querySelectorAll(".page-content"),H=document.getElementById("rotation-x"),A=document.getElementById("rotation-y"),z=document.getElementById("toggle-auto-rotate"),F=document.getElementById("base-map"),G=document.getElementById("normal-map"),N=document.getElementById("roughness-map"),W=document.getElementById("displacement-map"),X=document.getElementById("ao-map"),Y=document.getElementById("base-strength"),Z=document.getElementById("normal-strength"),q=document.getElementById("roughness-strength"),J=document.getElementById("displacement-strength"),O=document.getElementById("ao-strength"),V=document.getElementById("metalness"),K=document.getElementById("light-x"),Q=document.getElementById("light-y"),ee=document.getElementById("light-z"),et=document.getElementById("base-value"),ea=document.getElementById("normal-value"),en=document.getElementById("roughness-value"),ei=document.getElementById("displacement-value"),er=document.getElementById("ao-value"),eo=document.getElementById("metalness-value"),el=document.getElementById("download-base"),es=document.getElementById("download-normal"),ed=document.getElementById("download-roughness"),ec=document.getElementById("download-displacement"),eg=document.getElementById("download-ao"),em=document.getElementById("export-zip"),eu=document.getElementById("export-threejs"),eh=document.getElementById("export-base"),ep=document.getElementById("export-normal"),e$=document.getElementById("export-roughness"),ef=document.getElementById("export-displacement"),ev=document.getElementById("export-ao"),ex=document.getElementById("export-format"),ew=document.getElementById("base-format"),eE=document.getElementById("normal-format"),ey=document.getElementById("roughness-format"),e_=document.getElementById("displacement-format"),eL=document.getElementById("ao-format"),eb=document.getElementById("toggle-grid"),eI=document.getElementById("reset-controls"),e0=document.getElementById("processing-indicator"),eB=document.getElementById("progress-bar"),e3=document.getElementById("processing-message"),eC=document.getElementById("notification-container"),e2=["Teaching photons how to bounce properly...","Converting 2D boringness into 3D awesomeness...","Convincing pixels to work in the third dimension...","Calculating normal vectors (they seem quite abnormal)...","Making your texture look fabulous in 3D...","Generating bumps where there were none before...","Analyzing surface details with microscopic precision...","Persuading light to interact with virtual materials...","Extracting roughness from smooth images (it's rough work)...","Creating ambient occlusion where the sun don't shine...","Giving depth to the depthless...","Turning flat images into not-so-flat textures...","Simulating reality one pixel at a time...","Activating hyper-realistic texture algorithms...","Applying digital sandpaper for perfect roughness...","Making virtual surfaces feel touchable...","Crafting PBR magic with digital pixie dust...","Converting your image into a material science miracle...","Enhancing reality without the RTX graphics card...","Calculating how shadows would hide if they could..."];function eS(){n&&e.remove(n);let t=new THREE.SphereGeometry(1,64,64),a=new THREE.MeshStandardMaterial({color:16777215,roughness:parseFloat(q.value),metalness:parseFloat(V.value)});o&&(o.needsUpdate=!0),l&&(l.needsUpdate=!0),s&&(s.needsUpdate=!0),d&&(d.needsUpdate=!0),c&&(c.needsUpdate=!0),a.map=o,a.normalMap=l,a.roughnessMap=s,a.displacementMap=d,a.aoMap=c,l&&(a.normalScale=new THREE.Vector2(parseFloat(Z.value),parseFloat(Z.value))),d&&(a.displacementScale=parseFloat(J.value)),a.needsUpdate=!0,n=new THREE.Mesh(t,a),t.setAttribute("uv2",t.attributes.uv),e.add(n),console.log("Sphere created with textures:",{base:!!a.map,normal:!!a.normalMap,roughness:!!a.roughnessMap,displacement:!!a.displacementMap,ao:!!a.aoMap})}function eT(){t&&a&&B&&(t.aspect=B.clientWidth/B.clientHeight,t.updateProjectionMatrix(),a.setSize(B.clientWidth,B.clientHeight))}function e9(e){n&&($=!0,v={x:e.clientX,y:e.clientY},document.addEventListener("mousemove",ek),document.addEventListener("mouseup",eP),e.preventDefault())}function ek(e){if(!$||!n)return;let t={x:e.clientX-v.x,y:e.clientY-v.y};n.rotation.y+=.01*t.x,n.rotation.x+=.01*t.y,H.value=n.rotation.x,A.value=n.rotation.y,v={x:e.clientX,y:e.clientY}}function eP(){$=!1,document.removeEventListener("mousemove",ek),document.removeEventListener("mouseup",eP)}function eR(e){n&&(e.preventDefault(),$=!0,1===e.touches.length&&(v={x:e.touches[0].clientX,y:e.touches[0].clientY},document.addEventListener("touchmove",eD,{passive:!1}),document.addEventListener("touchend",eU)))}function eD(e){if($&&n&&(e.preventDefault(),1===e.touches.length)){let t={x:e.touches[0].clientX-v.x,y:e.touches[0].clientY-v.y};n.rotation.y+=.01*t.x,n.rotation.x+=.01*t.y,H.value=n.rotation.x,A.value=n.rotation.y,v={x:e.touches[0].clientX,y:e.touches[0].clientY}}}function eU(){$=!1,document.removeEventListener("touchmove",eD),document.removeEventListener("touchend",eU)}function eM(){r&&(x=!x,r.visible=x,x?(eb.classList.add("active"),e8("Grid enabled","info")):(eb.classList.remove("active"),e8("Grid disabled","info")))}function ej(){Y.value=w.baseStrength,Z.value=w.normalStrength,q.value=w.roughnessStrength,J.value=w.displacementStrength,O.value=w.aoStrength,V.value=w.metalness,K.value=w.lightX,Q.value=w.lightY,ee.value=w.lightZ,et.textContent=w.baseStrength.toFixed(1),ea.textContent=w.normalStrength.toFixed(1),en.textContent=w.roughnessStrength.toFixed(1),ei.textContent=w.displacementStrength.toFixed(1),er.textContent=w.aoStrength.toFixed(1),eo.textContent=w.metalness.toFixed(1),n&&n.material&&(n.material.roughness=w.roughnessStrength,n.material.metalness=w.metalness,n.material.normalMap&&n.material.normalScale.set(w.normalStrength,w.normalStrength),n.material.displacementMap&&(n.material.displacementScale=w.displacementStrength),n.material.needsUpdate=!0),i&&i.position.set(w.lightX,w.lightY,w.lightZ),e8("Settings reset to defaults","success")}function e1(e){let t=e.getContext("2d");t.clearRect(0,0,e.width,e.height)}function eH(e){console.log("File upload triggered",e.target.files),e.target.files&&e.target.files.length&&eA(e.target.files[0])}function eA(e){if(console.log("Processing file:",e),!e||!e.type.match("image.*")){e8("Please upload an image file.","error");return}let t=ez();e4(t,10);let n=new FileReader;n.onload=function(t){try{eG(30),eN(ez()),b.src=t.target.result,L.style.display="flex",m=!0,function e(t){let a=t.size/1024,n;n=a>=1024?(a/1024).toFixed(2)+" MB":a.toFixed(2)+" KB";let i=t.type.match(/image\/(\w+)/),r=i?i[1].toUpperCase():"Unknown";S.textContent=n,T.textContent=r;let o=new Image;o.onload=function(){C.textContent=o.width+" \xd7 "+o.height},o.src=URL.createObjectURL(t)}(e);let n=new Image;n.onload=function(){try{var e;eG(50),eN(ez()),g=function e(t){let a=document.createElement("canvas");a.width=t.width,a.height=t.height;let n=a.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,a.width,a.height)}(n),eG(60),eN(ez()),e=n,function e(t){F.width=t.width,F.height=t.height;let n=F.getContext("2d");n.drawImage(t,0,0),o=new THREE.Texture(F),a&&(o.anisotropy=a.capabilities.getMaxAnisotropy()),o.needsUpdate=!0,console.log("Base color map generated")}(e),function e(t){G.width=t.width,G.height=t.height;let a=G.getContext("2d"),n=a.createImageData(t.width,t.height),i=[-1,0,1,-2,0,2,-1,0,1],r=[-1,-2,-1,0,0,0,1,2,1];for(let o=0;o<t.height;o++)for(let s=0;s<t.width;s++){let d=0,c=0;for(let g=-1;g<=1;g++)for(let m=-1;m<=1;m++){let u=Math.min(t.width-1,Math.max(0,s+m)),h=Math.min(t.height-1,Math.max(0,o+g)),p=(h*t.width+u)*4,$=(t.data[p]+t.data[p+1]+t.data[p+2])/3;d+=$*i[(g+1)*3+(m+1)],c+=$*r[(g+1)*3+(m+1)]}let f=-(3*d),v=-(3*c),x=Math.sqrt(f*f+v*v+4e4),w=(o*t.width+s)*4;n.data[w]=(f/x*.5+.5)*255,n.data[w+1]=(v/x*.5+.5)*255,n.data[w+2]=(200/x*.5+.5)*255,n.data[w+3]=255}a.putImageData(n,0,0),(l=new THREE.Texture(G)).needsUpdate=!0,console.log("Normal map generated")}(g),function e(t){N.width=t.width,N.height=t.height;let a=N.getContext("2d"),n=a.createImageData(t.width,t.height);for(let i=0;i<t.height;i++)for(let r=0;r<t.width;r++){let o=(i*t.width+r)*4,l=0,d=0;for(let c=-1;c<=1;c++)for(let g=-1;g<=1;g++){let m=Math.min(t.width-1,Math.max(0,r+g)),u=Math.min(t.height-1,Math.max(0,i+c)),h=(u*t.width+m)*4,p=(i*t.width+r)*4,$=(t.data[p]+t.data[p+1]+t.data[p+2])/3,f=(t.data[h]+t.data[h+1]+t.data[h+2])/3;l+=Math.pow(f-$,2),d++}let v=Math.sqrt(l/d)/16,x=(t.data[o]+t.data[o+1]+t.data[o+2])/3;v=Math.min(1,Math.max(0,v=.6*v+(255-x)/255*.4));let w=255*v;n.data[o]=w,n.data[o+1]=w,n.data[o+2]=w,n.data[o+3]=255}a.putImageData(n,0,0),(s=new THREE.Texture(N)).needsUpdate=!0,console.log("Roughness map generated")}(g),function e(t){W.width=t.width,W.height=t.height;let a=W.getContext("2d"),n=a.createImageData(t.width,t.height);for(let i=0;i<t.data.length;i+=4){let r=t.data[i],o=t.data[i+1],l=t.data[i+2],s=Math.round(.299*r+.587*o+.114*l);s=Math.max(0,Math.min(255,(s-128)*1.2+128)),n.data[i]=s,n.data[i+1]=s,n.data[i+2]=s,n.data[i+3]=255}a.putImageData(n,0,0),(d=new THREE.Texture(W)).needsUpdate=!0,console.log("Displacement map generated")}(g),function e(t){X.width=t.width,X.height=t.height;let a=X.getContext("2d"),n=a.createImageData(t.width,t.height),i=document.createElement("canvas");i.width=t.width,i.height=t.height;let r=i.getContext("2d");r.putImageData(t,0,0),r.filter="blur(2px)",r.drawImage(i,0,0);let o=r.getImageData(0,0,i.width,i.height);r.filter="none";for(let l=0;l<t.height;l++)for(let s=0;s<t.width;s++){let d=(l*t.width+s)*4,g=0,m=0;for(let u=-2;u<=2;u++)for(let h=-2;h<=2;h++){if(0===h&&0===u)continue;let p=Math.min(t.width-1,Math.max(0,s+h)),$=Math.min(t.height-1,Math.max(0,l+u)),f=($*t.width+p)*4,v=(o.data[d]+o.data[d+1]+o.data[d+2])/3,x=(o.data[f]+o.data[f+1]+o.data[f+2])/3;g+=Math.abs(x-v),m++}let w=g/m,E=255-1.5*w,y=(t.data[d]+t.data[d+1]+t.data[d+2])/3;E=Math.max(100,Math.min(255,((E=Math.max(0,Math.min(255,E=.7*E+(255-y)*.3)))-128)*1.2+128)),n.data[d]=E,n.data[d+1]=E,n.data[d+2]=E,n.data[d+3]=255}a.putImageData(n,0,0),(c=new THREE.Texture(X)).needsUpdate=!0,console.log("AO map generated")}(g),F.width&&F.height&&(k.textContent=`${F.width} \xd7 ${F.height}`,P.textContent=`${G.width} \xd7 ${G.height}`,R.textContent=`${N.width} \xd7 ${N.height}`,D.textContent=`${W.width} \xd7 ${W.height}`,U.textContent=`${X.width} \xd7 ${X.height}`),eG(90),eN("Applying to 3D model... Almost there!"),eS(),setTimeout(()=>{eG(100),eW(),e8("Texture maps generated successfully!","success")},500)}catch(t){console.error("Error processing image:",t),eF()}},n.src=t.target.result}catch(i){console.error("Error loading image:",i),eF()}},n.onerror=function(){eF()},n.readAsDataURL(e)}function ez(){return e2[Math.floor(Math.random()*e2.length)]}function eF(){eW(),e8("Error processing image. Please try another image.","error")}function e4(e,t=0){e3.textContent=e,eB.style.width=`${t}%`,e0.style.display="flex"}function eG(e){eB.style.width=`${e}%`}function eN(e){e3.textContent=e}function eW(){e0.style.display="none"}function e8(e,t="info"){let a=document.createElement("div");a.className=`notification ${t}`,a.innerHTML=`
            <div class="notification-icon">
                <i class="fas ${({success:"fa-check-circle",error:"fa-exclamation-circle",info:"fa-info-circle",warning:"fa-exclamation-triangle"})[t]}"></i>
            </div>
            <div class="notification-content">
                <h4 class="notification-title">${({success:"Success",error:"Error",info:"Information",warning:"Warning"})[t]}</h4>
                <p class="notification-message">${e}</p>
            </div>
            <button class="notification-close">
                <i class="fas fa-times"></i>
            </button>
        `,eC.appendChild(a);let n=a.querySelector(".notification-close");n.addEventListener("click",()=>{a.classList.remove("show"),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)}),setTimeout(()=>{a.classList.add("show")},10),setTimeout(()=>{a.parentNode&&(a.classList.remove("show"),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300))},5e3)}function eX(){et.textContent=parseFloat(Y.value).toFixed(1),ea.textContent=parseFloat(Z.value).toFixed(1),en.textContent=parseFloat(q.value).toFixed(1),ei.textContent=parseFloat(J.value).toFixed(1),er.textContent=parseFloat(O.value).toFixed(1),n&&n.material?(n.material.normalMap&&n.material.normalScale.set(parseFloat(Z.value),parseFloat(Z.value)),n.material.displacementMap&&(n.material.displacementScale=parseFloat(J.value)),n.material.needsUpdate=!0):eS()}function eY(){eo.textContent=parseFloat(V.value).toFixed(1),n&&n.material&&(n.material.metalness=parseFloat(V.value),n.material.needsUpdate=!0)}function eZ(){i&&i.position.set(parseFloat(K.value),parseFloat(Q.value),parseFloat(ee.value))}function e6(e,t){let a=e.width,n=e.height,i=a*n*4*({png:.8,webp:.4,jpeg:.2})[t];return i>1048576?(i/1048576).toFixed(2)+" MB":(i/1024).toFixed(2)+" KB"}function eq(e,t,a="png"){if(!m){e8("Please upload a texture first","error");return}let n=document.createElement("a");switch(a){case"webp":n.href=e.toDataURL("image/webp"),n.download=`${t}.webp`;break;case"jpeg":n.href=e.toDataURL("image/jpeg",.9),n.download=`${t}.jpg`;break;default:n.href=e.toDataURL("image/png"),n.download=`${t}.png`}n.click(),e8(`${t.split("-")[0]} map downloaded as ${{png:"PNG",webp:"WebP",jpeg:"JPEG"}[a]}`,"success")}function e5(){if(!m){e8("Please upload a texture first","error");return}if("undefined"==typeof JSZip||"undefined"==typeof saveAs){e8("ZIP export libraries not loaded. Please refresh and try again.","error");return}let e=new JSZip,t="texture",a=0,n=ex.value,i="webp"===n?"webp":"jpeg"===n?"jpg":"png";if(e4("Packaging texture maps...",10),eh.checked&&F){let r;r="webp"===n?F.toDataURL("image/webp"):"jpeg"===n?F.toDataURL("image/jpeg",.9):F.toDataURL("image/png"),e.file(`${t}_basecolor.${i}`,e7(r),{base64:!1}),a++,eG(20)}if(ep.checked&&G){let o="jpeg"===n?"png":n,l;l="webp"===o?G.toDataURL("image/webp"):G.toDataURL("image/png"),e.file(`${t}_normal.${"webp"===o?"webp":"png"}`,e7(l),{base64:!1}),a++,eG(40)}if(e$.checked&&N){let s;s="webp"===n?N.toDataURL("image/webp"):"jpeg"===n?N.toDataURL("image/jpeg",.9):N.toDataURL("image/png"),e.file(`${t}_roughness.${i}`,e7(s),{base64:!1}),a++,eG(60)}if(ef.checked&&W){let d="jpeg"===n?"png":n,c;c="webp"===d?W.toDataURL("image/webp"):W.toDataURL("image/png"),e.file(`${t}_displacement.${"webp"===d?"webp":"png"}`,e7(c),{base64:!1}),a++,eG(80)}if(ev.checked&&X){let g;g="webp"===n?X.toDataURL("image/webp"):"jpeg"===n?X.toDataURL("image/jpeg",.9):X.toDataURL("image/png"),e.file(`${t}_ao.${i}`,e7(g),{base64:!1}),a++,eG(90)}if(0===a){eW(),e8("Please select at least one map to export","warning");return}eN("Creating ZIP file..."),e.generateAsync({type:"blob"}).then(function(e){eG(100),saveAs(e,`${t}_maps.zip`),setTimeout(()=>{eW(),e8(`${a} texture maps exported successfully as ${n.toUpperCase()}!`,"success")},500)}).catch(function(e){console.error("Error creating ZIP file:",e),eW(),e8("Error creating ZIP file. Please try again.","error")})}function e7(e){let t=e.split(";base64,"),a=t[0].split(":")[1],n=window.atob(t[1]),i=n.length,r=new Uint8Array(i);for(let o=0;o<i;++o)r[o]=n.charCodeAt(o);return new Blob([r],{type:a})}function eJ(){(u=!u)?(z.classList.add("active"),e8("Auto-rotation enabled","info")):(z.classList.remove("active"),e8("Auto-rotation disabled","info"))}function eO(){n&&(p||(p=!0,u=!1,z.classList.remove("active")),n.rotation.x=parseFloat(H.value),n.rotation.y=parseFloat(A.value))}function eV(){if(!m){e8("Please upload a texture first","error");return}let e=ex.value,t="webp"===e?"webp":"jpeg"===e?"jpg":"png";e4("Generating Three.js code...",50);let a=`/**
 * Three.js Material Example with Exported Textures
 * Generated by Texture Gen v2
 * 
 * This code implements a PBR material setup using the texture maps
 * generated and configured in Texture Gen v2.
 */
import * as THREE from 'three';

// Create a scene, camera, and renderer
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({ 
    antialias: true,
    alpha: true 
});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

// Load textures
const textureLoader = new THREE.TextureLoader();
const baseTexture = textureLoader.load('texture_basecolor.${t}');
const normalTexture = textureLoader.load('texture_normal.${"jpeg"===e?"png":t}');
const roughnessTexture = textureLoader.load('texture_roughness.${t}');
const displacementTexture = textureLoader.load('texture_displacement.${"jpeg"===e?"png":t}');
const aoTexture = textureLoader.load('texture_ao.${t}');

// Create material with all maps
const material = new THREE.MeshStandardMaterial({
    map: baseTexture,
    normalMap: normalTexture,
    roughnessMap: roughnessTexture,
    displacementMap: displacementTexture,
    aoMap: aoTexture,
    normalScale: new THREE.Vector2(${Z.value}, ${Z.value}),
    roughness: ${q.value},
    metalness: ${V.value},
    displacementScale: ${J.value}
});

// Create a sphere geometry with high resolution for better displacement
const geometry = new THREE.SphereGeometry(2, 64, 64);
const mesh = new THREE.Mesh(geometry, material);

// For ambient occlusion to work, we need UV2
geometry.setAttribute('uv2', geometry.attributes.uv);

scene.add(mesh);

// Add lights
const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
scene.add(ambientLight);

const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
directionalLight.position.set(${K.value}, ${Q.value}, ${ee.value});
scene.add(directionalLight);

// Add subtle hemisphere light for better detail visibility
const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.3);
hemiLight.position.set(0, 20, 0);
scene.add(hemiLight);

// Animation loop
function animate() {
    requestAnimationFrame(animate);
    
    // Rotation animation
    mesh.rotation.y += 0.005;
    
    renderer.render(scene, camera);
}

animate();

// Handle window resize
window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});`;setTimeout(()=>{eG(100);let e=new Blob([a],{type:"text/javascript"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="texture_material.js",n.click(),eW(),e8("Three.js code exported successfully","success")},800)}!function v(){if("undefined"==typeof THREE){console.error("THREE is not defined. Please check if Three.js is loaded correctly."),e8("Error loading Three.js library. Please refresh and try again.","error");return}if("undefined"==typeof JSZip){console.error("JSZip is not defined. Please check if JSZip is loaded correctly."),e8("Error loading JSZip library. Please refresh and try again.","error");return}try{(function o(){(e=new THREE.Scene).background=new THREE.Color(856343),(t=new THREE.PerspectiveCamera(75,B.clientWidth/B.clientHeight,.1,1e3)).position.z=3,t.position.y=.5,(a=new THREE.WebGLRenderer({antialias:!0,alpha:!0})).setSize(B.clientWidth,B.clientHeight),a.setPixelRatio(window.devicePixelRatio),B.appendChild(a.domElement),(i=new THREE.DirectionalLight(16777215,1.5)).position.set(5,5,5),e.add(i);let l=new THREE.AmbientLight(16777215,.7);e.add(l);let s=new THREE.HemisphereLight(16777215,4473924,.3);s.position.set(0,20,0),e.add(s),(r=new THREE.GridHelper(10,20,4473924,2434341)).position.y=-1.5,e.add(r),eS(),e4("Initializing 3D environment...",0);let d=0,c=setInterval(()=>{(d+=10)<=100?eG(d):(clearInterval(c),eW())},100);window.addEventListener("resize",eT),function i(){f=requestAnimationFrame(i),n&&u&&!$&&(n.rotation.y+=h.y,n.rotation.x+=h.x,p||(H.value=(n.rotation.x%(2*Math.PI)+2*Math.PI)%(2*Math.PI)-Math.PI,A.value=(n.rotation.y%(2*Math.PI)+2*Math.PI)%(2*Math.PI)-Math.PI)),a&&a.render(e,t)}()})(),function e(){_.addEventListener("change",eH),_.addEventListener("click",function(e){e.stopPropagation()}),E.addEventListener("dragover",e=>{e.preventDefault(),E.classList.add("active")}),E.addEventListener("dragleave",()=>{E.classList.remove("active")}),E.addEventListener("drop",e=>{e.preventDefault(),E.classList.remove("active"),e.dataTransfer.files.length&&eA(e.dataTransfer.files[0])}),y.addEventListener("click",e=>{e.stopPropagation(),m||(_.value="",setTimeout(()=>{_.click()},10))}),I.addEventListener("click",e=>{e.stopPropagation(),L.style.display="none",b.src="",m=!1,C.textContent="-",S.textContent="-",T.textContent="-",k.textContent="-",P.textContent="-",R.textContent="-",D.textContent="-",U.textContent="-",n&&n.material&&(n.material.map=null,n.material.normalMap=null,n.material.roughnessMap=null,n.material.displacementMap=null,n.material.aoMap=null,n.material.needsUpdate=!0),e1(F),e1(G),e1(N),e1(W),e1(X),o=null,l=null,s=null,d=null,c=null,g=null,e8("Image removed","info")}),Y.addEventListener("input",eX),Z.addEventListener("input",eX),q.addEventListener("input",eX),J.addEventListener("input",eX),O.addEventListener("input",eX),V.addEventListener("input",eY),K.addEventListener("input",eZ),Q.addEventListener("input",eZ),ee.addEventListener("input",eZ),eb.addEventListener("click",eM),eI.addEventListener("click",ej),el.addEventListener("click",()=>eq(F,"basecolor-map",ew.value)),es.addEventListener("click",()=>eq(G,"normal-map",eE.value)),ed.addEventListener("click",()=>eq(N,"roughness-map",ey.value)),ec.addEventListener("click",()=>eq(W,"displacement-map",e_.value)),eg.addEventListener("click",()=>eq(X,"ao-map",eL.value)),em.addEventListener("click",e5),eu&&eu.addEventListener("click",eV),H.addEventListener("input",eO),A.addEventListener("input",eO),z.addEventListener("click",eJ),B.addEventListener("mousedown",e9),B.addEventListener("touchstart",eR,{passive:!1});let t=document.querySelectorAll('input[type="range"]');t.forEach(e=>{e.addEventListener("mousedown",()=>{p=!0,document.addEventListener("mouseup",function e(){p=!1,document.removeEventListener("mouseup",e)},{once:!0})}),e.addEventListener("touchstart",()=>{p=!0,document.addEventListener("touchend",function e(){p=!1,document.removeEventListener("touchend",e)},{once:!0})})})}(),M.forEach(e=>{e.addEventListener("click",()=>{M.forEach(e=>e.classList.remove("active")),e.classList.add("active");let t=e.dataset.page;j.forEach(e=>{e.id===`${t}-page`?(e.classList.remove("hidden"),setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},50)):(e.style.opacity="0",e.style.transform="translateY(10px)",setTimeout(()=>{e.classList.add("hidden")},300))})})}),document.addEventListener("keydown",e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"SELECT"!==e.target.tagName)switch(e.key.toLowerCase()){case"r":ej();break;case"g":eM();break;case"a":eJ();break;case"e":m?e5():e8("Please upload a texture first","warning");break;case"c":m?eV():e8("Please upload a texture first","warning");break;case"arrowleft":n&&(n.rotation.y-=.1,p||(A.value=n.rotation.y));break;case"arrowright":n&&(n.rotation.y+=.1,p||(A.value=n.rotation.y));break;case"arrowup":n&&(n.rotation.x-=.1,p||(H.value=n.rotation.x));break;case"arrowdown":n&&(n.rotation.x+=.1,p||(H.value=n.rotation.x))}}),eb.classList.add("active"),z.classList.add("active")}catch(x){console.error("Error initializing application:",x),e8("Error initializing application. Please refresh the page.","error")}}()});
